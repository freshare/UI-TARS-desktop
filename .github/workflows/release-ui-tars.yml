name: Release UI-TARS app
on:
  workflow_dispatch:

env:
  CI: true
  NODE_OPTIONS: --max-old-space-size=8192
  HUSKY: 0

# ğŸ‘‡ è¿™ä¸€æ®µæ˜¯ä¿®å¤æŠ¥é”™çš„æ ¸å¿ƒï¼Œä½ å·²ç»åŠ å¯¹äº†
permissions:
  contents: write      # å…è®¸ä¸Šä¼  Release é™„ä»¶
  id-token: write      # å…è®¸ OIDC èº«ä»½éªŒè¯ï¼ˆå¦‚æœç”¨åˆ°ï¼‰
  attestations: write  # å…è®¸ç”Ÿæˆæ„å»ºè¯æ˜

jobs:
  publish_on_win:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Show operating system info
        run: |
          echo "Operating System:"
          cmd /c ver

      - name: Install pnpm
        run: npm install -g pnpm@9

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'
      
      # ä¾èµ–å®‰è£…
      - name: install dependencies
        run: pnpm install --no-frozen-lockfile

      # å‘å¸ƒæ­¥éª¤
      - name: publish
        env:
          # å¿…é¡»ä¼ é€’ GITHUB_TOKENï¼Œå¦åˆ™æ— æ³•ä¸Šä¼  Release
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # å¿…é¡»ä¼ é€’ç§é’¥ï¼Œå¦åˆ™æ‰“åŒ…ä¼šå¤±è´¥
          UI_TARS_APP_PRIVATE_KEY_BASE64: ${{ secrets.UI_TARS_APP_PRIVATE_KEY_BASE64 }}
        # è¿›å…¥åº”ç”¨ç›®å½•å¹¶æ‰§è¡Œå‘å¸ƒå‘½ä»¤
        run: cd apps/ui-tars && pnpm run publish:win32
