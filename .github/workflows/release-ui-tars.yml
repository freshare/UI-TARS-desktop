name: Release UI-TARS app
on:
  workflow_dispatch:

env:
  CI: true
  NODE_OPTIONS: --max-old-space-size=8192
  HUSKY: 0

permissions:
  id-token: write
  contents: write
  attestations: write

jobs:
  # 只保留这一个 Windows 任务，其他全删了
  publish_on_win:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Show operating system info
        run: |
          echo "Operating System:"
          cmd /c ver
      - name: Install pnpm
        run: npm install -g pnpm@9
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'
      
      # 这里是你改对的关键命令：
      - name: install dependencies
        run: pnpm install --no-frozen-lockfile

      - name: publish
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          UI_TARS_APP_PRIVATE_KEY_BASE64: ${{ secrets.UI_TARS_APP_PRIVATE_KEY_BASE64 }}
        run: cd apps/ui-tars && pnpm run publish:win32
